# 根节点枚举

根节点枚举会触发“stop the world”的，因为如果不触发的话，势必导致枚举的不准确。
（这里与之前的标记整理算法不同，标记整理算法是在整理的时候由于要涉及到全部的对象，所以要触发“stop the world”）

## OopMap

OopMap记录了栈上本地变量到堆上对象的引用关系，用于帮助根节点枚举。

思想：栈上的内存或全局引用只有一部分是Reference类型，我们只需要处理这些是Reference类型的部分。所以只单独开辟一块空间进行记录。

OopMap不能一直进行，如果为每一条指令都创建一个OopMap就会占用大量的额外空间，不然会过多的占用内存，所以需要有个安全点的概念。

## 安全点
进行垃圾收集的时候，所有的线程必须到安全点。

安全点的选取是根据“是否具有让程序长时间执行的特征”

**方法调用、循环跳转、异常跳转**（认为这些中不会导致引用关系的变化）
### 抢先式中断
虚拟机去中断全部线程，然后如果有线程没到安全点就继续执行直到安全点
### 主动式中断（主要使用）
设置一个标志位，线程执行的时候主动去轮询标志位，如果为真那么就在最近的安全点主动中断挂起。

轮询的位置与安全点重合，并且在创建对象和需要分配内存的时候进行。

## 安全区域

如有线程处于sleep或者blocked状态，线程无法响应中断请求。

安全区域是能够保证在一段代码中，引用关系不会发生变化，这个区域的任何一个部分开始垃圾收集都是安全的。其实就是一种延伸的安全点。

