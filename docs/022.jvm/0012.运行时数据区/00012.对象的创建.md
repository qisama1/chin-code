# 对象的创建
我们来讨论一下一个普通对象的创建要经过那些步骤

## 1. 此类型有没有被加载
当我们的Java虚拟机遇到一条new指令的时候，首先会检查能否在常量池定位到一个类的符号引用，并且检查这个符号引用所代表的类有没有被加载好（加载、连接、初始化）。如果没有，那么先要进行初始化

## 2. 为新生对象分配内存

一个对象的占用内存，在类加载完成后就可以确定了。

### 对象的构成

#### 对象头
对象头由MarkWord和klass point共同组成，如果是数组对象，那么还需有数组的长度。
#### 实例数据
实例数据就是对象里面的属性等的数据
#### 对齐填充
由于Java里默认以8字节为单位，那么

### 如何分配内存
#### 指针碰撞
假设java堆中按照使用过的内存和没有使用过的内存，每次只需要把指针移动，分配出对象所需的空间即可。
##### 弊端
1. 指针碰撞是需要GC有空间压缩整理的能力的，如果是标记清除的话，并不能做到使用的部分和空闲的部分完全隔开。
2. 并发问题，如果有多个线程想去开辟空间，就会存在并发问题。

解决方案：
1. CAS去移动指针
2. TLAB（Thread Local Allocation Buffer）每个线程额外的先去获取一块内存，然后在此去分配内存。
#### 空闲列表
空闲列表就像是操作系统中页表一样的思想。它用单独的一个列表去维护哪些内存是空闲可用的，然后从中去分配空间。
##### 弊端
弊端就是用了额外的空间。

### new一个Object对象占多少内存
首先markword在64位系统为64位-8byte 

klasspoint压缩以后为4byte

Object没有实例的属性为0

对齐填充4byte后为16byte
## 3. 初始化零值
内存分配完毕后，虚拟机必须将分配到的空间都初始化为零值。这保证了对象的实例字段在Java代码中不赋初值就可以直接使用。

## 4. 设置对象
设置对象头等信息

## 5. 执行构造函数init
目前从虚拟机角度来说，以及创建好了一个对象，但是现在还没有进行初始化构造呢。

目前所有的字段都是默认的零值，我们需要按程序员的意图去为这些对象赋值。