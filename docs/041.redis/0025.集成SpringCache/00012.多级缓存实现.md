# 多级缓存的实现

## Nginx
Nginx上设置location，其中location的配置项写明转发由lua脚本来决定
### OpenResty
集成了Nginx，变成可支持lua脚本配置Nginx

### Nginx规则
Nginx能够反向代理，发送HTTP请求到tomcat本地服务器

根据某个id哈希进行负载均衡，如用户的请求根据游戏id，那么就要根据这个游戏id去进行哈希，然后这样每次用户的请求都可以打到同一个服务器，这样一来就可以减少缓存失效的场景。

但是任何策略都不是完美的，这样的操作会导致如果有巨热点的数据，那么这样操作会导致一个机器负载过高，那么还是不如轮询负载均衡。

### Nginx本地缓存
Nginx能够开启共享字典，其实也就是本地缓存。
查询Redis、Tomcat启动后，都要把数据写入本地缓存，并设置有效期
## Caffeine

## Redis
Redis数据预热，要将一些经常、热点的数据提前放入到Redis当中进行预热

## 数据库

## 数据同步策略

缓存的目的是为了AP，那么如果想要更为CP，就需要做到缓存同步，有缓存同步策略。

### 设置有效期
- 优势：简单、方便
- 缺点：时效性差，缓存过期前会有不一致情况
- 场景：更新频率较低的，时效性要求低的业务

### 同步双写：在修改数据库的同时、直接修改缓存
- 优势：时效性强、缓存和数据库强一致
- 缺点：有代码入侵，耦合度高
- 场景：对一致性要求高的数据
### 异步通知
修改数据库的时候发送通知，由消费者去修改缓存数据
- 优势：低耦合
- 缺点：时效性一般
- 场景：时效性要求一般，由多个服务需要同步

这里使用canal，监听mysql的binlog，发现binlog发生变化后去更新缓存