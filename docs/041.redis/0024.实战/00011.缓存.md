# 缓存

## 缓存雪崩
缓存雪崩就是有大量请求无法找到缓存，直接打到了数据库上，导致数据库的压力巨大，称之为雪崩。
### 因为宕机
此时redis宕机了，那么固然会直接打到数据库上。

1. 此时就应该去调整redis的模式了，应该采取集群，这样就可以应对redis因为宕机导致的雪崩
2. 抢救的办法，降级、限流、熔断

### 因为大量key同时过期
1. 大量key同时过期，那么说明此时设置过期时间的方式不对，应该分布的更加随机些。

## 缓存穿透
缓存穿透，就一个透最关键，说出了它打穿了数据库也。请求了一个根本不存在的key。
### 解决方式
1. 既然它要找一个没有出现过的key，那么我们可以在他请求过来的时候，就给他在redis上为他生成一个缓存，同时为了减少空间的占用，我们要为这个key设置过期时间。
2. 布隆过滤器，布隆过滤器的作用就是判断是否不在这个集合里面。如果发现我们根本没有这个key，直接给他这个清求隔断。
## 缓存击穿
击穿，字面上来看就是盯着一个点来打。也就是我们的热点数据过期了。
### 解决方式
1. 针对于这样的热点数据，如大促的时候，必须要提前给缓存续期到大促结束
2. 给锁，在访问数据库前加一个分布式锁，只允许一个线程去访问到数据库，然后重新设置缓存，这样就可以避免数据库压力过大。

## 缓存一致性问题

我们使用的是先更新数据库，后删除缓存的方案。

不可避免的是，这个方案仍然是存在问题的。

1. 当一个线程查询到没有缓存的数据，去请求数据库，然后更新缓存，但是要更新缓存的时候卡顿了。在卡顿的时候另一个线程完成了数据的更新。此时这个线程又去更新了缓存，出现了数据库和redis不一致。但是这个触发的条件十分严苛。
2. 删除缓存失败，那么会导致有旧的缓存存在，查到的是更新前的值。

你想解决，那么就来个锁咯，让这些请求都串行不就可以了。可以用redisson加一个读写锁。或者使用canal。