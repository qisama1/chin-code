# redis大key解决方案

大key其实是指的是大value，也就是慢查询
## 基本概念
1. value值所占空间过大时为大key
2. value是stirng类型，大小控制在10kb以内
3. value是hash，list，set，zset等集合类型，元素个数不要超过5000。

上述都是可以自行定义的。

## 场景
大key是由于业务方设计不合理，没有考虑到value的未来的增长
1. value一直塞数据
2. 数据没有合理的分片

### 场景列举
1. 明星或者大V的粉丝列表
2. 统计游戏活动玩家的榜单、列表。
3. 例如把一个视频的所有信息都存在一个巨大的json里面，导致json过大而产生的大key。

## 大key导致的问题
1. 客户端超时阻塞：redis是单线程的，那么这样的大key就会导致后续的操作都被阻塞
2. 内存空间分配不均匀：部分有大key的redis占用内存高，QPS高
3. 引发网络阻塞：这么一个超大的数据传输，对于网络来说比较难顶
4. 阻塞工作线程：当执行大key的删除的时候，会阻塞主线程。

## 如何检查大key
1. redis上有个大key的埋点，上报给redis大key检测平台，监控报警
2. scan + memory usage, 循环检测每个键值的字节数
3. python脚本迭代scan key，然后判断是否为大key
4. rediscli --bigkeys去检查大key
5. rdbtools可以解析快照文件，在快照文件中去检查大key

## 大key如何删除
1. 改名字，进行一个逻辑的删除
2. 小步，多批量的进行删除