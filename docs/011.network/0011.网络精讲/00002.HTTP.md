# HTTP
## HTTP1.1的优点
1. 简单，header+body，header也是以key-value的形式存在，易于理解。
2. 灵活、易扩展和填充，header的格式没有被限定死，可以由程序员自己扩充
3. 应用广泛，主要也是浏览器都支持了HTTP。

## HTTP1.1的缺点
1. 无状态的双刃剑。无状态指的是上一次发送的http，服务器这边不会做保存，也减轻服务器的负担。但是这也是坏处，如果有关联操作的时候，会比较麻烦。比如一个用户的加入购物车、下单、付款这些操作都是有关联的，但是服务器不知道。这个是可以由cookie来解决。
2. 明文传输，http的消息是裸奔的，没有进行加密。
3. 不安全。

如上的安全问题就由HTTPS来解决。S指的是SSL/TLS

## HTTP1.1的性能
### 长连接
connection:keep-alive开启长连接。

正常的http开启以后之后的发送是需要再次的三次握手的。而长连接则是在一段时间内，可以不用再三次握手，在此次连接再次发送消息。

### 管道传输
因为使用了长连接，就不用是一个请求一个回复这样了，可以是多个请求一起发送出去。但是服务器返回的消息是要按管道请求的顺序的。

### 队头阻塞
在使用了长连接以后，那么如果有其中的一个请求卡住了，那么后面的请求也会一直卡住。这叫做队头阻塞。

## HTTPS
### 解决的问题：
1. 窃听风险：比如通信链路上的内容，可能被窃听
2. 篡改风险：强行填充垃圾内容，视觉污染
3. 冒充风险：可能冒充盗版网站，无法认证真实性

### 解决的方法
1. 信息加密：消息传输不再是明文。混合加密实现消息的机密性。
2. 校验机制：如果篡改了内容就无法正常显示，摘要算法实现完整性，给数据生成独一无二的指纹，用于校验消息的完整性。
3. 身份证书：服务器是需要通过CA证书认证的。

### 混合加密
HTTPS采用了对称加密+非对称加密的混合加密形式。
1. 在通信建立前使用非对称加密的方式交换会话秘钥，之后就不再使用。
2. 在通信过程全程使用对称加密的会话秘钥来加密数据

#### 为什么采用混合加密
1. 对称加密只是用一个秘钥，运算速度快，并且秘钥必须保密，无法安全做到秘钥交换。
2. 非对称加密使用两个秘钥，公钥和私钥，公钥可以任意发送，而私钥需要保密。解决了交换问题但是速度满。

### 摘要算法+数字签名
为什么防止数据不被篡改，所以需要给数据一个指纹，然后与内容一起传送给对方。

对方收到了以后可以自己也算出这样一个指纹，再进行对比一下，这样就能发现到底是不是一样的。这个和JWT挺像的。

具体来说，就是使用摘要算法（哈希）来计算出内容的哈希值，这个哈希值是唯一的，并且无法反推出内容。

因为数据+哈希可以保证数据没被篡改，但是呢，如果把数据和哈希全部一起换了，那么也是有问题的。所以这时就需要保证这个消息是来自于服务端的。

### 非对称加密

#### 公钥加密 私钥解密
保证传输内容的安全，因为只有私钥，也就是只有自己能看到内容的真实信息
#### 私钥加密 公钥解密
能保证消息的来源，因为公钥能解密出来的只能是私钥传输的消息

流程：
1. 内容得到哈希值
2. 私钥加密哈希值为数字签名，内容+签名一起发送
3. 内容进行哈希运算，以及数字签名进行公钥解密。看能否对上。如果对得上则是确定内容是完整的没有被篡改，同时也是来自于私钥方。

### 数字证书
个人信息 + 公钥 + 数字签名打包成一个数字证书，放到一个公认的平台验证。这个平台叫CA，所以CA认证的数字证书也很重要。

此时服务器发送的时候会附带上CA的数字签名，客户端拿到后用CA的公钥去验证数字签名的真实性。

## 建立SSL/TLS连接

### Client Hello
客户端向服务器发送一个HTTPs请求，这是要发送一个ClientHello请求。

1. 客户端支持的TLS版本
2. 客户端的随机数，用于后续生成会话秘钥
3. 客户端支持的加密算法

### ServerHello
1. 确认TLS版本
2. 服务端的随机数，同样也是用来生成秘钥
3. 确认的加密算法，如RSA算法
4. 服务器的数字证书

### 客户端回应
首先要用浏览器或者操作系统的CA公钥验证CA证书是否真实（因为只有CA私钥加密的才能用公钥解锁）。没问题的话，此时就获取到了服务器的公钥，并可以用它加密报文。

1. 一个随机数，已经被公钥加密
2. 加密通信算法改变通知，表示后续都会用会话秘钥通信
3. 对之前发送的内容做个摘要，让服务器验证

### 服务器回应
通过这三个随机数，生成一个会话秘钥。
1. 加密算法改变通知，表示之后都用会话秘钥通信。
2. 服务器握手结束通知，同时把之前发送的东西做个摘要，让客户端来校验。

## 如何验证CA公钥是否正确

### 签发过程
服务器发送自己的公钥等信息到CA。CA给这段信息生成一个签名，生成一段哈希。

### 验证阶段
客户端会收到服务器发过来的公钥等信息以及CA私钥对哈希的加密。

自己对公钥等信息进行签名求得哈希，与公钥解密CA发过来的，看是否一致。