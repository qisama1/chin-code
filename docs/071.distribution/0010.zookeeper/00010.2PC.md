# 2PC(2 phase commit) 两阶段提交

两阶段提交通常是用在处理分布式事务的时候，比如我们的抽奖系统此时要落库抽奖结果，同时进行发送mq去进行发奖的操作。但是因为网络、服务等原因这个mq的发送操作是可能失败的，那么我们需要做一些一致性的保障。

两阶段提交就是用来处理强一致性的。

## 节点有哪些
有一个用于协调一致性的协调者，以及处理事务的参与者。

## 具体流程
所谓的两阶段，就是一个确认过程。

1. 首先我们将这个事务的操作告知协调者，协调者通知各个参与者进行这个操作，但是呢，参与者并不会在此时提交事务。当参与者处理完之后会给协调者一个确认的信息。
2. 协调者会收集这些确认的信息，当全部收集完成，他就认为ok，大家都准备好了哦，那么就提交！如果有节点并没有回复成功，那么就会发送命令回滚这些操作。
3. 如果所有的参与者都回复成功了，这时候就会发送commit命令，让所有的参与者都提交事务，事成之后也会回复成功的信息。

## 缺点
1. 单点故障问题无法解决，当协调者出现故障的时候，整个系统就挂掉了
2. 阻塞问题，如果协调者收到了prepare，但是协调者挂了，那么它也收不到回滚的命令也收不到提交的命令，就会导致这个事务一直夯在这，浪费cpu以及内存。
3. 数据不一致问题，当有人收到了commit消息提交了，但是此时节点挂了，导致有一些还没收到呢。就会出现不一致问题。