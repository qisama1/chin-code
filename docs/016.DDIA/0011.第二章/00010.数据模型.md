# 数据模型

## 如何分析一个数据模型

1. 基本考察点：数据基本元素，元素之间的对应关系
2. 利用几种常用模型来比较：（最为流行的）关系模型、（树状型）文档模型、（极大自由度）图模型
3. schema模型：强schema（写时约束）；弱schema（读时解析）

## 如何考察查询语言
1. 如何与数据模型关联、匹配
2. 声明式、命令式

## 数据模型
数据模型：如何组织数据、如何标准化关系、如何关联现实

它既决定了我们构建软件的方式，也左右了我们看待问题的角度。

### 数据模型分层

1. 应用开发者：关注将具体问题抽象为一组对象、数据结构、以及作用于其上的API
2. DBA：为了持久化数据结构，将上述表达为通用的数据模型，如XML/JSON或者是关系数据库中的表、图数据库中的图
3. 数据库系统开发者：需要将上述的数据结构组织为内存、硬盘或者网络中的bytes流（比特流），并且提供操作数据集合的办法
4. 硬件工程师：将字节流表示为二极管中的电位、磁场中的磁极、光纤中的光信号。

在每一层都要对外暴露简洁的数据模型，隔离和分解现实世界的复杂度

## 关系模型vs文档模型

### 关系模型
当今最流行的数据模型。

特点：
1. 将数据以关系呈现给用户
2. 提供操作数据集合的关系算子

常见分类：
1. 事务型（TP）：银行交易、火车票，对于数据量要求不大而对于事务有要求
2. 分析性（AP）：数据报表、监控表盘，对数据量要求大、事务无要求
3. 混合型（HTAP）：

### NoSQL
由于数据处理的精细化要求，但是关系模式无法适应到具体的各个场景。NoSQL带来了以下冲击：
1. 处理更大的数据集：更强伸缩性、更高吞吐
2. 开源免费：冲击了关系型数据库厂商的地位
3. 特化的查询操作：关系数据库难以支持的，比如途中的多跳分析
4. 表达能力更强：关系模型约束太严，限制太多

### 文档模型
原文用比尔盖茨的简历来说明一个问题：关系型数据库很难以解决嵌套模型，一对多的关系。

例如：简历里面一个人可能有多个教育经历和工作经历、而关系型数据库很难以去这样描述。

天然的文档模型：Json、XML，可以通过嵌套的方式，轻松描述

文档模型的优势：
1. 模式灵活：可以动态增删字段
2. 更好的局部性：一个人的所有属性被集中访问的同时，也被集中存储。这也就是解决了随机IO读写。
3. 结构表达语义：简历和联系信息、教育经历、职业信息等关系，都可以通过嵌套的树状模型来表达。

### 多对多和一对多

#### 一对多
region在存储的时候，为什么不直接设置“北京”，而是设置为region_id -> region_name，在其他用到的时候都用region_id

1. 为了统一样式，所有用到这个地区的地方都有同样的格式和样式
2. 避免歧义：可能会有同名地区
3. 易于修改：有点类似于句柄池一样，如果一个地区进行了名字的修改，只要把region_id对应的region_name修改，而不用把所有用到region_name的地方修改。
4. 本地化支持：如果翻译到了其他语言，可以只翻译名字
5. 更好搜索：更便于关联，进行树形组织

#### 多对多
文档型数据库就不太擅长进行多对多的操作了。当要处理多对多的关系的时候，可能就变成了所有数据全取出来再去应用层操作，而关系型数据库一般提供了join

### ID和文本
ID对于人类是无意义的，所以ID就不会因为现实世界的改动而变化
